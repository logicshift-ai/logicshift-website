<header
  class="header {{ if site.Params.navbar_fixed }}sticky top-0{{ end }} z-30">
  <nav
    class="navbar container relative flex items-center justify-between"
    x-data="{ mobileOpen: false }"
    :class="{ 'overflow-hidden': mobileOpen }"
    @keydown.window.escape="mobileOpen = false">
    <!-- Logo -->
    <div class="order-0">
      <a class="navbar-brand block" href="{{ site.Home.RelPermalink }}">
        {{ partial "logo" }}
      </a>
    </div>

    <!-- Mobile Toggler -->
    <button
      type="button"
      @click="mobileOpen = !mobileOpen"
      :aria-expanded="mobileOpen"
      class="order-3 lg:order-1 flex items-center lg:hidden cursor-pointer text-text-dark dark:text-white">
      <!-- Hamburger -->
      <svg
        x-show="!mobileOpen"
        x-cloak
        class="h-6 fill-current"
        viewBox="0 0 20 20">
        <path d="M0 3h20v2H0V3z M0 9h20v2H0V9z M0 15h20v2H0V15z"></path>
      </svg>
      <svg
        x-show="mobileOpen"
        x-cloak
        class="h-6 fill-current transform rotate-180"
        viewBox="0 0 20 20">
        <polygon
          points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2"
          transform="rotate(45 10 10)"></polygon>
      </svg>
    </button>

    <!-- Navigation Menu -->
    <ul
      id="nav-menu"
      x-cloak
      class="
        navbar-nav
        order-3 w-full pb-6
        lg:order-1 lg:flex lg:w-auto lg:space-x-8 lg:pb-0
        lg:absolute lg:left-1/2 lg:transform lg:-translate-x-1/2
      "
      :class="{ 'block': mobileOpen, 'hidden': !mobileOpen }">
      {{ range site.Menus.main }}
        {{ $menuLink := .URL | relLangURL }}

        {{ if .HasChildren }}
          <li
            class="nav-item nav-dropdown relative"
            x-data="{ open: false }"
            @click.away="open = false">
            <button
              type="button"
              @click="open = !open"
              class="nav-link inline-flex items-center"
              :class="{ 'active': open }">
              {{ .Name }}
              <svg class="h-4 w-4 fill-current ml-1" viewBox="0 0 20 20">
                <path
                  d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
              </svg>
            </button>
            <ul class="nav-dropdown-list" x-show="open" x-transition x-cloak>
              {{ range .Children }}
                {{ $childLink := .URL | relLangURL }}
                <li class="nav-dropdown-item">
                  <a
                    class="nav-dropdown-link"
                    @click="open = false; mobileOpen = false"
                    href="{{ if findRE `^#` .URL }}
                      {{ if not $.IsHome }}
                        {{ site.Home.RelPermalink }}
                      {{ end }}{{ .URL }}
                    {{ else }}
                      {{ .URL | relLangURL }}
                    {{ end }}"
                    {{ if findRE `^http` .URL }}
                      target="_blank" rel="noopener"
                    {{ end }}>
                    {{ .Name }}
                  </a>
                </li>
              {{ end }}
            </ul>
          </li>
        {{ else }}
          <li class="nav-item">
            <a
              class="nav-link"
              @click="mobileOpen = false"
              href="{{ if findRE `^#` .URL }}
                {{ if not $.IsHome }}
                  {{ site.Home.RelPermalink }}
                {{ end }}{{ .URL }}
              {{ else }}
                {{ .URL | relLangURL }}
              {{ end }}"
              {{ if findRE `^http` .URL }}
                target="_blank" rel="noopener"
              {{ end }}>
              {{ .Name }}
            </a>
          </li>
        {{ end }}
      {{ end }}

      {{ if site.Params.navigation_button.enable }}
        <li class="mt-4 lg:hidden">
          <a
            class="btn btn-outline-primary btn-sm"
            href="{{ site.Params.navigation_button.link | relLangURL }}">
            {{ site.Params.navigation_button.label }}
          </a>
        </li>
      {{ end }}
    </ul>

    <!-- Right-hand Actions -->
    <div
      class="order-1 ml-auto flex items-center md:order-2 lg:ml-0 justify-end">
      {{ with site.Params.search }}
        {{ if .enable }}
          <button
            aria-label="search"
            {{ if and (not site.Params.navigation_button.enable) (not site.Params.theme_switcher) }}
              class="border-border text-text-dark hover:text-primary
              dark:border-darkmode-border mr-5 inline-block border-r
              lg:border-r-0 pr-5 lg:pr-0 text-xl dark:text-white
              dark:hover:text-darkmode-primary"
            {{ else }}
              class="border-border text-text-dark hover:text-primary
              dark:border-darkmode-border mr-5 inline-block border-r pr-5
              text-xl dark:text-white dark:hover:text-darkmode-primary"
            {{ end }}
            data-target="search-modal">
            <i class="fa-solid fa-search"></i>
          </button>
        {{ end }}
      {{ end }}

      {{ partial "components/language-switcher" (dict "Context" . "Class" "mr-5 pl-2 py-1 dark:bg-darkmode-light rounded") }}
      {{ partial "components/theme-switcher" (dict "Class" "mr-5") }}

      {{ if site.Params.navigation_button.enable }}
        <a
          href="{{ site.Params.navigation_button.link | relLangURL }}"
          class="btn btn-outline-primary btn-sm hidden lg:inline-block">
          {{ site.Params.navigation_button.label }}
        </a>
      {{ end }}
    </div>
  </nav>
</header>
